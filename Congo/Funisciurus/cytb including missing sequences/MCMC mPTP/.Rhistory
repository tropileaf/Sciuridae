library(readxl)
library(stringr)
library(dplyr)
library(fuzzyjoin)
install.packages("fuzzyjoin")
library(fuzzyjoin)
library(readxl)
df_excel <- read_excel("Desktop/Corrections Article Genetique Ecureuils LF_PB_LF_jm2_LF2.xlsx")
View(df_excel)
library(readr)
txt_lines <- read_csv("Documents/GitHub/Sciuridae/Congo/Funisciurus/apob/asap/Unique_Overlapping_One_Outgroup.fas.Partition_1.txt")
View(txt_lines)
species <- character(0)
records <- data.frame(Species = character(),
SeqName = character(),
stringsAsFactors = FALSE)
for (line in txt_lines) {
# Check if the line defines a Species header
if (str_detect(line, "^Species\\s*\\d+")) {
species <- str_trim(line)
} else if (str_trim(line) != "") {
# Otherwise treat it as a sequence name entry
records <- rbind(records,
data.frame(Species = species,
SeqName = str_trim(line)))
}
}
matched <- stringdist_inner_join(records, df_excel,
by = c("SeqName" = "Sequence_Name"),
max_dist = 3,    # adjust (1â€“5) depending on similarity
distance_col = "dist")
unmatched <- anti_join(records, matched, by = c("SeqName"))
if (nrow(unmatched) > 0) {
message("These TXT sequence names could NOT be matched to the Excel column:\n")
print(unmatched)
} else {
message("All TXT names successfully matched!")
}
# matched has: Species, SeqName (original TXT), Sequence_Name (Excel version), dist
df_excel <- df_excel %>%
left_join(matched %>% select(Sequence_Name, Species),
by = "Sequence_Name") %>%
rename(APOB_ASAP_OTU = Species)
### ---- 6. Save result ---- ###
write.xlsx(df_excel, "excel_with_species_filled.xlsx", overwrite = TRUE)
library(readxl)
df_excel <- read_excel("Desktop/Corrections Article Genetique Ecureuils LF_PB_LF_jm2_LF2.xlsx")
View(df_excel)
library(readr)
Unique_Overlapping_One_Outgroup_fas_Partition_1 <- read_csv("Documents/GitHub/Sciuridae/Congo/Funisciurus/apob/asap/Unique_Overlapping_One_Outgroup.fas.Partition_1.csv")
View(Unique_Overlapping_One_Outgroup_fas_Partition_1)
library(readr)
txt_file <- read_csv("Documents/GitHub/Sciuridae/Congo/Funisciurus/apob/asap/Unique_Overlapping_One_Outgroup.fas.Partition_1.csv")
View(txt_file)
library(readxl)
df_excel <- read_excel("Desktop/Corrections Article Genetique Ecureuils LF_PB_LF_jm2_LF2.xlsx")
View(df_excel)
library(openxlsx)
df_csv <. txt_file
df_csv <- txt_file
colnames(df_csv) <- c("SeqName", "SpeciesNum")
# Convert species number to label (optional)
df_csv$Species <- paste0("Species ", df_csv$SpeciesNum)
matched <- stringdist_inner_join(df_csv, df_excel,
by = c("SeqName" = "Sequence_Name"),
max_dist = 3,  # adjust if needed
distance_col = "dist")
unmatched <- anti_join(df_csv, matched, by = "SeqName")
if (nrow(unmatched) > 0) {
message("The following sequences from the CSV could NOT be matched:\n")
print(unmatched)
} else {
message("All CSV sequence names matched successfully!")
}
View(df_csv)
matched <- stringdist_inner_join(df_csv, df_excel,
by = c("SeqName" = "Sequence_Name"),
max_dist = 20,  # adjust if needed
distance_col = "dist")
unmatched <- anti_join(df_csv, matched, by = "SeqName")
if (nrow(unmatched) > 0) {
message("The following sequences from the CSV could NOT be matched:\n")
print(unmatched)
} else {
message("All CSV sequence names matched successfully!")
}
df_excel <- df_excel %>%
left_join(matched %>% select(Sequence_Name, Species),
by = "Sequence_Name") %>%
mutate(APOB_ASAP_OTU = Species)
matched <- stringdist_inner_join(df_csv, df_excel,
by = c("SeqName" = "Sequence_Name"),
max_dist = 20,  # adjust if needed
distance_col = "dist")
unmatched <- anti_join(df_csv, matched, by = "SeqName")
if (nrow(unmatched) > 0) {
message("The following sequences from the CSV could NOT be matched:\n")
print(unmatched)
} else {
message("All CSV sequence names matched successfully!")
}
df_excel <- df_excel %>%
left_join(matched %>% select(Sequence_Name, Species),
by = "Sequence_Name") %>%
mutate(APOB_ASAP_OTU = Species)
df_excel <- df_excel %>%
left_join(matched %>% select(Sequence_Name, SpeciesNum),
by = "Sequence_Name") %>%
mutate(APOB_ASAP_OTU = Species)
View(df_csv)
View(df_excel)
df_excel <- df_excel %>%
left_join(matched %>% select(Sequence_Name, SpeciesNum),
by = "Sequence_Name") %>%
mutate(APOB_ASAP_OTU = Species)
write.xlsx(df_excel, "excel_with_species_filled.xlsx", overwrite = TRUE)
library(readxl)
df_excel <- read_excel("Desktop/Corrections Article Genetique Ecureuils LF_PB_LF_jm2_LF2.xlsx")
View(df_excel)
library(readr)
df_csv <- read_csv("Documents/GitHub/Sciuridae/Congo/Funisciurus/apob/asap/Unique_Overlapping_One_Outgroup.fas.Partition_1.csv")
View(df_csv)
# Excel
df_excel <- df_excel %>%
mutate(TrimmedName = str_replace(Sample_ID, "_.*$", ""))
# CSV
df_csv <- df_csv %>%
mutate(TrimmedName = str_replace(SeqName, "_.*$", ""))
colnames(df_csv) <- c("SeqName", "SpeciesNum")
# CSV
df_csv <- df_csv %>%
mutate(TrimmedName = str_replace(SeqName, "_.*$", ""))
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesNum),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n")
print(unmatched)
} else {
message("All CSV sequence names matched successfully!")
}
View(df_csv)
View(df_excel)
clean_name <- function(x) {
x %>%
toupper() %>%                 # make uppercase
str_trim() %>%                # remove whitespace
str_replace("_.*$", "")       # remove after "_"
}
df_excel$TrimmedName <- clean_name(df_excel$Sample_ID)
df_csv$TrimmedName   <- clean_name(df_csv$SeqName)
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesNum),
by = "TrimmedName")
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesNum),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n")
print(unmatched)
} else {
message("All CSV sequence names matched successfully!")
}
df_excel$APOB_ASAP_OTU <- matched$SpeciesNum
setwd("~/Desktop")
write.xlsx(df_excel, "excel_with_species_filled.xlsx", overwrite = TRUE)
library(openxlsx)
install.packages("openxlsx")
library(openxlsx)
write.xlsx(df_excel, "excel_with_species_filled.xlsx", overwrite = TRUE)
library(readxl)
library(dplyr)
library(openxlsx)
library(stringr)
### ---- Helper function to clean sequence names ---- ###
clean_name <- function(x) {
x %>%
toupper() %>%          # standardize case
str_trim() %>%         # remove whitespace
str_replace("_.*$", "")  # remove everything after first "_"
}
setwd("~/Documents/GitHub/Sciuridae/Congo")
# Excel (contains Sample_ID and empty APOB_ASAP_OTU)
df_excel <- read_excel("Corrections Article Genetique Ecureuils LF_PB_LF_jm2_LF2.xlsx")
# CSV (no header)
df_csv <- read.csv("Unique_Overlapping_One_Outgroup.fas.Partition_1.csv", header = FALSE, stringsAsFactors = FALSE)
setwd("~/Documents/GitHub/Sciuridae/Congo/Funisciurus/apob/asap")
# CSV (no header)
df_csv <- read.csv("Unique_Overlapping_One_Outgroup.fas.Partition_1.csv", header = FALSE, stringsAsFactors = FALSE)
colnames(df_csv) <- c("SeqName", "SpeciesNum")
df_excel <- df_excel %>%
mutate(TrimmedName = clean_name(Sample_ID))
df_csv <- df_csv %>%
mutate(TrimmedName = clean_name(SeqName))
species_map <- c(
"1" = "Fa",
"2" = "Fp_RB",
"3" = "Fx",
"4" = "Fb",
"5" = "P_LB"
)
df_csv$SpeciesLabel <- species_map[as.character(df_csv$SpeciesNum)]
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesLabel),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n")
print(unmatched)
} else {
message("All CSV names matched successfully!")
}
df_excel$APOB_ASAP_OTU <- matched$SpeciesLabel
write.xlsx(df_excel, "excel_with_species_filled.xlsx", overwrite = TRUE)
setwd("~/Documents/GitHub/Sciuridae/Congo/Funisciurus/apob/mPTP/MCMC-mPTP webservice seed set to 11111 burnin increased to 5000 steps increased to 500000")
# CSV (no header)
df_csv <- read.csv("APOBmPTP.csv", header = FALSE, stringsAsFactors = FALSE)
colnames(df_csv) <- c("SeqName", "SpeciesNum")
setwd("~/Documents/GitHub/Sciuridae/Congo/Funisciurus/apob/mPTP/MCMC-mPTP webservice seed set to 11111 burnin increased to 5000 steps increased to 500000")
# CSV (no header)
df_csv <- read.csv("APOBmPTP.csv", header = FALSE, stringsAsFactors = FALSE)
View(df_csv)
library(readr)
APOBmPTP <- read_delim("APOBmPTP.csv", delim = ";",
escape_double = FALSE, trim_ws = TRUE)
View(APOBmPTP)
df_csv <-APOBmPTP
View(df_csv)
#df_csv <- read.csv("APOBmPTP.csv", header = FALSE, stringsAsFactors = FALSE)
colnames(df_csv) <- c("SeqName", "SpeciesNum")
species_map <- c(
"2" = "Fa",
"3" = "Fb",
"1" = "P_LB"
)
df_csv$SpeciesLabel <- species_map[as.character(df_csv$SpeciesNum)]
df_csv <- df_csv %>%
mutate(TrimmedName = clean_name(SeqName))
species_map <- c(
"2" = "Fa",
"3" = "Fb",
"1" = "P_LB"
)
df_csv$SpeciesLabel <- species_map[as.character(df_csv$SpeciesNum)]
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesLabel),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n") # manually fill in excel file at the end
print(unmatched)
} else {
message("All CSV names matched successfully!")
}
df_excel <- read_excel("excel_with_species_filled.xlsx")
# CSV (no header)
APOBmPTP <- read_delim("APOBmPTP.csv", delim = ";",
escape_double = FALSE, trim_ws = TRUE)
View(APOBmPTP)
df_csv <-APOBmPTP
#df_csv <- read.csv("APOBmPTP.csv", header = FALSE, stringsAsFactors = FALSE)
colnames(df_csv) <- c("SeqName", "SpeciesNum")
df_excel <- df_excel %>%
mutate(TrimmedName = clean_name(Sample_ID))
df_csv <- df_csv %>%
mutate(TrimmedName = clean_name(SeqName))
### ---- Helper function to clean sequence names ---- ###
clean_name <- function(x) {
x %>%
toupper() %>%          # standardize case
str_trim() %>%         # remove whitespace
str_replace("_.*$", "")  # remove everything after first "_"
}
df_excel <- df_excel %>%
mutate(TrimmedName = clean_name(Sample_ID))
df_csv <- df_csv %>%
mutate(TrimmedName = clean_name(SeqName))
species_map <- c(
"2" = "Fa",
"3" = "Fb",
"1" = "P_LB"
)
df_csv$SpeciesLabel <- species_map[as.character(df_csv$SpeciesNum)]
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesLabel),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n") # manually fill in excel file at the end
print(unmatched)
} else {
message("All CSV names matched successfully!")
}
df_excel$APOB_ASAP_OTU <- matched$SpeciesLabel
View(df_excel)
df_excel <- df_excel %>%
mutate(TrimmedName = clean_name(Sequence_Name))
df_csv <- df_csv %>%
mutate(TrimmedName = clean_name(SeqName))
species_map <- c(
"2" = "Fa",
"3" = "Fb",
"1" = "P_LB"
)
df_csv$SpeciesLabel <- species_map[as.character(df_csv$SpeciesNum)]
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesLabel),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n") # manually fill in excel file at the end
print(unmatched)
} else {
message("All CSV names matched successfully!")
}
df_excel$APOB_ASAP_OTU <- matched$SpeciesLabel
write.xlsx(df_excel, "excel_with_species_filled_APOB.xlsx", overwrite = TRUE)
### ---- Helper function to clean sequence names ---- ###
clean_name <- function(x) {
x %>%
toupper() %>%          # standardize case
str_trim() %>%         # remove whitespace
str_replace("_.*$", "")  # remove everything after first "_"
}
# CSV (no header)
APOBmPTP <- read_delim("APOBmPTP.csv", delim = ";",
escape_double = FALSE, trim_ws = TRUE)
View(APOBmPTP)
df_csv <-APOBmPTP
#df_csv <- read.csv("APOBmPTP.csv", header = FALSE, stringsAsFactors = FALSE)
colnames(df_csv) <- c("SeqName", "SpeciesNum")
df_excel <- df_excel %>%
mutate(TrimmedName = clean_name(Sequence_Name))
df_excel <- read_excel("excel_with_species_filled.xlsx")
df_excel <- df_excel %>%
mutate(TrimmedName = clean_name(Sequence_Name))
df_csv <- df_csv %>%
mutate(TrimmedName = clean_name(SeqName))
species_map <- c(
"2" = "Fa",
"3" = "Fb",
"1" = "P_LB"
)
df_csv$SpeciesLabel <- species_map[as.character(df_csv$SpeciesNum)]
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesLabel),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n") # manually fill in excel file at the end
print(unmatched)
} else {
message("All CSV names matched successfully!")
}
df_excel$APOB_mPTP_OTU <- matched$SpeciesLabel
write.xlsx(df_excel, "excel_with_species_filled_APOB.xlsx", overwrite = TRUE)
setwd("~/Documents/GitHub/Sciuridae/Congo/Funisciurus/cytb including missing sequences/asap abgd/eb8f1076-7786-4440-969e-6c45eedab308_20251126/asap")
### ---- Helper function to clean sequence names ---- ###
clean_name <- function(x) {
x %>%
toupper() %>%          # standardize case
str_trim() %>%         # remove whitespace
str_replace("_.*$", "")  # remove everything after first "_"
}
# Excel (contains Sample_ID and empty CYTB_ASAP_OTU)
df_excel <- read_excel("excel_with_species_filled_APOB.xlsx")
# CSV (no header)
df_csv <- read.csv("Unique_Missing_Overlap.fas.Partition_1.csv", header = FALSE, stringsAsFactors = FALSE)
colnames(df_csv) <- c("SeqName", "SpeciesNum")
View(df_csv)
df_csv <- df_csv %>%
mutate(TrimmedName = clean_name(SeqName))
View(df_csv)
species_map <- c(
"1" = "Fa_LB",
"2" = "Fa_RB",
"3" = "Fc",
"4" = "Fp_RB",
"6" = "GenBank",
"8" = "Fx",
"9" = "P_LB",
"7" = "Fb_sp1",
"5" = "Fb_sp2"
)
df_csv$SpeciesLabel <- species_map[as.character(df_csv$SpeciesNum)]
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesLabel),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n") # manually fill in excel file at the end
print(unmatched)
} else {
message("All CSV names matched successfully!")
}
df_excel$APOB_ASAP_OTU <- matched$SpeciesLabel
write.xlsx(df_excel, "excel_with_species_filled_CYTP_ASAP.xlsx", overwrite = TRUE)
library(readxl)
library(dplyr)
library(openxlsx)
library(stringr)
### ---- Helper function to clean sequence names ---- ###
clean_name <- function(x) {
x %>%
toupper() %>%          # standardize case
str_trim() %>%         # remove whitespace
str_replace("_.*$", "")  # remove everything after first "_"
}
# Excel (contains Sample_ID and empty CYTB_ASAP_OTU)
df_excel <- read_excel("excel_with_species_filled_APOB.xlsx")
# CSV (no header)
df_csv <- read.csv("Unique_Missing_Overlap.fas.Partition_1.csv", header = FALSE, stringsAsFactors = FALSE)
colnames(df_csv) <- c("SeqName", "SpeciesNum")
df_csv <- df_csv %>%
mutate(TrimmedName = clean_name(SeqName))
species_map <- c(
"1" = "Fa_LB",
"2" = "Fa_RB",
"3" = "Fc",
"4" = "Fp_RB",
"6" = "GenBank",
"8" = "Fx",
"9" = "P_LB",
"7" = "Fb_sp1",
"5" = "Fb_sp2"
)
df_csv$SpeciesLabel <- species_map[as.character(df_csv$SpeciesNum)]
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesLabel),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n") # manually fill in excel file at the end
print(unmatched)
} else {
message("All CSV names matched successfully!")
}
df_excel$CYTB_ASAP_OTU <- matched$SpeciesLabel
write.xlsx(df_excel, "excel_with_species_filled_CYTP_ASAP.xlsx", overwrite = TRUE)
setwd("~/Documents/GitHub/Sciuridae/Congo/Funisciurus/cytb including missing sequences/asap abgd/eb8f1076-7786-4440-969e-6c45eedab308_20251126/asap")
write.xlsx(df_excel, "excel_with_species_filled_CYTP_ASAP.xlsx", overwrite = TRUE)
setwd("~/Documents/GitHub/Sciuridae/Congo/Funisciurus/cytb including missing sequences/MCMC mPTP")
# CSV (no header)
CYTBmPTP <- read_delim("CYTBmPTP.csv", delim = ";", # first, manually make csv using the output file
escape_double = FALSE, trim_ws = TRUE)
# CSV (no header)
CYTBmPTP <- read_delim("CYTBmPTP.csv", delim = ";", # first, manually make csv using the output file
escape_double = FALSE, trim_ws = TRUE)
View(CYTBmPTP)
df_csv <-CYTBmPTP
#df_csv <- read.csv("APOBmPTP.csv", header = FALSE, stringsAsFactors = FALSE)
colnames(df_csv) <- c("SeqName", "SpeciesNum")
df_csv <- df_csv %>%
mutate(TrimmedName = clean_name(SeqName))
species_map <- c(
"2" = "Fa",
"3" = "Fb",
"1" = "P_LB"
)
df_excel <- read_excel("excel_with_species_filled_CYTB_ASAP.xlsx")
setwd("~/Documents/GitHub/Sciuridae/Congo/Funisciurus/cytb including missing sequences/MCMC mPTP")
df_excel <- read_excel("excel_with_species_filled_CYTB_ASAP.xlsx")
# CSV (no header)
CYTBmPTP <- read_delim("CYTBmPTP.csv", delim = ";", # first, manually make csv using the output file
escape_double = FALSE, trim_ws = TRUE)
df_excel <- read_excel("excel_with_species_filled_CYTB_ASAP.xlsx")
library(readxl)
df_excel <- read_excel("excel_with_species_filled_CYTP_ASAP.xlsx")
View(df_excel)
species_map <- c(
"2" = "Fx",
"3" = "Fa_LB",
"4" = "Fa_RB",
"5" = "Fc",
"6" = "Fp_RB",
"7" = "Fb_sp2",
"8" = "Genbank",
"9" = "Fb_sp1",
"1" = "P_LB"
)
df_csv$SpeciesLabel <- species_map[as.character(df_csv$SpeciesNum)]
matched <- df_excel %>%
left_join(df_csv %>% select(TrimmedName, SpeciesLabel),
by = "TrimmedName")
unmatched <- anti_join(df_csv, df_excel, by = "TrimmedName")
if (nrow(unmatched) > 0) {
message("The following CSV sequence names could NOT be matched:\n") # manually fill in excel file at the end
print(unmatched)
} else {
message("All CSV names matched successfully!")
}
df_excel$CYTB_mPTP_OTU <- matched$SpeciesLabel
write.xlsx(df_excel, "excel_with_species_filled_CYTB.xlsx", overwrite = TRUE)
